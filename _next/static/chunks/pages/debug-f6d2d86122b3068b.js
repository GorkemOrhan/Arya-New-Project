(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94],{2786:function(e,o,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/debug",function(){return n(2822)}])},4401:function(e,o,n){"use strict";n.d(o,{ts:function(){return h},$8:function(){return p},x4:function(){return u},kS:function(){return g},Rp:function(){return m}});var t=n(7066),r=n(1955),s=n(1752),i=n.n(s);let{publicRuntimeConfig:a={}}=i()()||{},l=a.basePath||"",c=t.Z.create({baseURL:"https://arya-new-project.onrender.com/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let o=r.Z.get("token");return console.log("Request interceptor - Token exists:",!!o),o?(e.headers.Authorization="Bearer ".concat(o),console.log("Adding Authorization header to request")):console.warn("No token found in cookies"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{if(e.response){if(401===e.response.status){console.error("API 401 Unauthorized error:",e.response.data);let o=e.config.url.includes("/auth/");if(!e.config.url.includes("/auth/validate-token")&&(console.warn("Unauthorized access (not during validation), clearing token"),r.Z.remove("token"),o)){let e="".concat(window.location.origin).concat(l,"/login");console.log("Redirecting to login page due to auth failure"),window.location.href=e}}}else console.error("API connection error:",e.message);return Promise.reject(e)});let{publicRuntimeConfig:d={}}=i()()||{};d.basePath;let u=async(e,o)=>{var n,t,s;try{console.log("Attempting login with email:",e);let{access_token:t,user:s}=(await c.post("/auth/login",{email:e,password:o})).data;if(console.log("Login successful, token received:",t?"Yes (length: "+t.length+")":"No"),console.log("User data received:",s),console.log("Is admin:",null==s?void 0:s.is_admin),!t)return console.error("No access token received from server"),{success:!1,message:"Authentication failed: No token received"};r.Z.remove("token"),r.Z.set("token",t,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"});let i=r.Z.get("token");if(console.log("Token stored in cookies:",!!i),console.log("Stored token length:",i?i.length:0),!i)return console.error("Failed to store token in cookies"),{success:!1,message:"Authentication failed: Unable to store token"};localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(s)),console.log("User info stored in localStorage:",s),console.log("Admin status stored:",s.is_admin);try{console.log("Validating token after login...");let e=await m();console.log("Token validation result:",e),e.success&&e.valid?(console.log("Token validated. User data from validation:",e.user),console.log("Admin status from validation:",null===(n=e.user)||void 0===n?void 0:n.is_admin),e.user&&(localStorage.setItem("user",JSON.stringify(e.user)),console.log("Updated user info in localStorage with validated data"))):console.warn("Token validation failed, but continuing with login.")}catch(e){console.error("Error validating token:",e)}return{success:!0,user:s}}catch(e){return console.error("Login error:",e),{success:!1,message:(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Login failed"}}},g=()=>(r.Z.remove("token"),localStorage.removeItem("user"),{success:!0}),h=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},p=()=>!!r.Z.get("token"),m=async()=>{let e=2;for(;e>=0;)try{console.log("Validating token...");let e=await c.get("/auth/validate-token");return console.log("Token validation response:",e.status),console.log("Token validation data:",e.data),e.data.valid&&e.data.user&&(localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Updated user data in localStorage from token validation"),console.log("Admin status from validation:",e.data.user.is_admin)),{success:!0,valid:e.data.valid,user:e.data.user}}catch(i){var o,n,t,r,s;if(!i.response&&e>0){console.warn("Network error during token validation, retrying... (".concat(e," attempts left)")),e--,await new Promise(e=>setTimeout(e,1e3));continue}return console.error("Token validation error:",i.message),console.error("Error response:",null===(o=i.response)||void 0===o?void 0:o.data),(null===(n=i.response)||void 0===n?void 0:n.status)===401&&console.warn("Token is invalid or expired"),{success:!1,valid:!1,status:null===(t=i.response)||void 0===t?void 0:t.status,message:(null===(s=i.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.error)||"Token validation failed"}}}},2822:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return l}});var t=n(5893),r=n(7294),s=n(1163),i=n(4401),a=n(1955);function l(){let e=(0,s.useRouter)(),[o,n]=(0,r.useState)({isLoading:!0,isAuthenticated:!1,currentUser:null,tokenValidation:null,token:null,error:null});return(0,r.useEffect)(()=>{(async function(){try{let e=(0,i.$8)();console.log("Debug: Is authenticated:",e);let o=a.Z.get("token");console.log("Debug: Token exists:",!!o),console.log("Debug: Token length:",o?o.length:0);let t=(0,i.ts)();console.log("Debug: Current user:",t),console.log("Debug: Is admin:",null==t?void 0:t.is_admin);let r=null;try{o&&(r=await (0,i.Rp)(),console.log("Debug: Token validation result:",r))}catch(e){console.error("Debug: Token validation error:",e)}n({isLoading:!1,isAuthenticated:e,currentUser:t,tokenValidation:r,token:o?"".concat(o.substring(0,10),"..."):null,error:null})}catch(e){console.error("Debug: Error in auth check:",e),n({isLoading:!1,error:e.message})}})()},[]),(0,t.jsxs)("div",{className:"container mx-auto px-4 py-10",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Authentication Debug"}),o.isLoading?(0,t.jsx)("p",{children:"Loading..."}):o.error?(0,t.jsx)("div",{className:"bg-red-100 p-4 rounded mb-4",children:(0,t.jsxs)("p",{className:"text-red-700",children:["Error: ",o.error]})}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"mb-6 bg-gray-100 p-4 rounded",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Authentication Status"}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Is Authenticated:"})," ",o.isAuthenticated?"Yes":"No"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Token (partial):"})," ",o.token||"None"]})]}),(0,t.jsxs)("div",{className:"mb-6 bg-gray-100 p-4 rounded",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"User Information"}),o.currentUser?(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Username:"})," ",o.currentUser.username]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",o.currentUser.email]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Is Admin:"})," ",o.currentUser.is_admin?"Yes":"No"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"User ID:"})," ",o.currentUser.id]})]}):(0,t.jsx)("p",{children:"No user information found"})]}),(0,t.jsxs)("div",{className:"mb-6 bg-gray-100 p-4 rounded",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Token Validation"}),o.tokenValidation?(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Valid:"})," ",o.tokenValidation.valid?"Yes":"No"]}),o.tokenValidation.user&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Validated User:"})," ",o.tokenValidation.user.username]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Validated Admin Status:"})," ",o.tokenValidation.user.is_admin?"Yes":"No"]})]})]}):(0,t.jsx)("p",{children:"No token validation information"})]}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)("button",{onClick:()=>e.push("/login"),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Go to Login"}),(0,t.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:"Go to Dashboard"}),(0,t.jsx)("button",{onClick:()=>e.push("/admin"),className:"bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded",children:"Go to Admin"})]})]})]})}},1163:function(e,o,n){e.exports=n(3079)},1955:function(e,o,n){"use strict";function t(e){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var t in n)e[t]=n[t]}return e}n.d(o,{Z:function(){return r}});var r=function e(o,n){function r(e,r,s){if("undefined"!=typeof document){"number"==typeof(s=t({},n,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in s)s[a]&&(i+="; "+a,!0!==s[a]&&(i+="="+s[a].split(";")[0]));return document.cookie=e+"="+o.write(r,e)+i}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],t={},r=0;r<n.length;r++){var s=n[r].split("="),i=s.slice(1).join("=");try{var a=decodeURIComponent(s[0]);if(t[a]=o.read(i,a),e===a)break}catch(e){}}return e?t[e]:t}},remove:function(e,o){r(e,"",t({},o,{expires:-1}))},withAttributes:function(o){return e(this.converter,t({},this.attributes,o))},withConverter:function(o){return e(t({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(o)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}},function(e){e.O(0,[330,888,774,179],function(){return e(e.s=2786)}),_N_E=e.O()}]);