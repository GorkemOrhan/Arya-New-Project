(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[459],{6429:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return t(1733)}])},4401:function(e,o,t){"use strict";t.d(o,{ts:function(){return m},$8:function(){return p},x4:function(){return u},kS:function(){return g},Rp:function(){return f}});var r=t(7066),s=t(1955),n=t(1752),a=t.n(n);let{publicRuntimeConfig:i={}}=a()()||{},l=i.basePath||"",c=r.Z.create({baseURL:"https://arya-new-project.onrender.com/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let o=s.Z.get("token");return console.log("Request interceptor - Token exists:",!!o),o?(e.headers.Authorization="Bearer ".concat(o),console.log("Adding Authorization header to request")):console.warn("No token found in cookies"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{if(e.response){if(401===e.response.status){console.error("API 401 Unauthorized error:",e.response.data);let o=e.config.url.includes("/auth/");if(!e.config.url.includes("/auth/validate-token")&&(console.warn("Unauthorized access (not during validation), clearing token"),s.Z.remove("token"),o)){let e="".concat(window.location.origin).concat(l,"/login");console.log("Redirecting to login page due to auth failure"),window.location.href=e}}}else console.error("API connection error:",e.message);return Promise.reject(e)});let{publicRuntimeConfig:d={}}=a()()||{};d.basePath;let u=async(e,o)=>{var t,r,n;try{console.log("Attempting login with email:",e);let{access_token:r,user:n}=(await c.post("/auth/login",{email:e,password:o})).data;if(console.log("Login successful, token received:",r?"Yes (length: "+r.length+")":"No"),console.log("User data received:",n),console.log("Is admin:",null==n?void 0:n.is_admin),!r)return console.error("No access token received from server"),{success:!1,message:"Authentication failed: No token received"};s.Z.remove("token"),s.Z.set("token",r,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"});let a=s.Z.get("token");if(console.log("Token stored in cookies:",!!a),console.log("Stored token length:",a?a.length:0),!a)return console.error("Failed to store token in cookies"),{success:!1,message:"Authentication failed: Unable to store token"};localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(n)),console.log("User info stored in localStorage:",n),console.log("Admin status stored:",n.is_admin);try{console.log("Validating token after login...");let e=await f();console.log("Token validation result:",e),e.success&&e.valid?(console.log("Token validated. User data from validation:",e.user),console.log("Admin status from validation:",null===(t=e.user)||void 0===t?void 0:t.is_admin),e.user&&(localStorage.setItem("user",JSON.stringify(e.user)),console.log("Updated user info in localStorage with validated data"))):console.warn("Token validation failed, but continuing with login.")}catch(e){console.error("Error validating token:",e)}return{success:!0,user:n}}catch(e){return console.error("Login error:",e),{success:!1,message:(null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.error)||"Login failed"}}},g=()=>(s.Z.remove("token"),localStorage.removeItem("user"),{success:!0}),m=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},p=()=>!!s.Z.get("token"),f=async()=>{let e=2;for(;e>=0;)try{console.log("Validating token...");let e=await c.get("/auth/validate-token");return console.log("Token validation response:",e.status),console.log("Token validation data:",e.data),e.data.valid&&e.data.user&&(localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Updated user data in localStorage from token validation"),console.log("Admin status from validation:",e.data.user.is_admin)),{success:!0,valid:e.data.valid,user:e.data.user}}catch(a){var o,t,r,s,n;if(!a.response&&e>0){console.warn("Network error during token validation, retrying... (".concat(e," attempts left)")),e--,await new Promise(e=>setTimeout(e,1e3));continue}return console.error("Token validation error:",a.message),console.error("Error response:",null===(o=a.response)||void 0===o?void 0:o.data),(null===(t=a.response)||void 0===t?void 0:t.status)===401&&console.warn("Token is invalid or expired"),{success:!1,valid:!1,status:null===(r=a.response)||void 0===r?void 0:r.status,message:(null===(n=a.response)||void 0===n?void 0:null===(s=n.data)||void 0===s?void 0:s.error)||"Token validation failed"}}}},7648:function(e,o,t){"use strict";var r=t(5893);t(7294),o.Z=e=>{let{children:o,type:t="button",variant:s="primary",size:n="md",className:a="",disabled:i=!1,onClick:l,...c}=e,d="".concat("btn inline-flex items-center justify-center rounded-md font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2"," ").concat({primary:"btn-primary focus:ring-primary-500",secondary:"btn-secondary focus:ring-secondary-500",danger:"btn-danger focus:ring-red-500",outline:"border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-primary-500",ghost:"bg-transparent text-gray-700 hover:bg-gray-100 focus:ring-primary-500"}[s]," ").concat({sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-base"}[n]," ").concat(i?"opacity-50 cursor-not-allowed":"cursor-pointer"," ").concat(a);return(0,r.jsx)("button",{type:t,className:d,disabled:i,onClick:l,...c,children:o})}},1733:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return u}});var r=t(5893),s=t(7294),n=t(1163),a=t(7536),i=t(2920);t(1664);var l=t(4401);let c=(0,s.forwardRef)((e,o)=>{let{label:t,name:s,type:n="text",placeholder:a,error:i,className:l="",...c}=e;return(0,r.jsxs)("div",{className:"mb-4",children:[t&&(0,r.jsx)("label",{htmlFor:s,className:"label",children:t}),(0,r.jsx)("input",{ref:o,id:s,name:s,type:n,placeholder:a,className:"input ".concat(i?"border-red-500 focus:ring-red-500 focus:border-red-500":""," ").concat(l),...c}),i&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:i})]})});c.displayName="Input";var d=t(7648),u=()=>{var e,o;let t=(0,n.useRouter)(),[u,g]=(0,s.useState)(!1),{register:m,handleSubmit:p,formState:{errors:f}}=(0,a.cI)();(0,s.useEffect)(()=>{if((0,l.$8)()){let e=(0,l.ts)();console.log("Login page: Already authenticated, user:",e),e&&e.is_admin?(console.log("Login page: Redirecting admin to admin dashboard"),t.push("/admin")):(console.log("Login page: Redirecting user to dashboard"),t.push("/dashboard"))}},[t]);let v=async e=>{g(!0);try{let o=await (0,l.x4)(e.email,e.password);if(o.success){i.Am.success("Login successful!");let{user:e}=o;console.log("Login successful, user:",e),e&&e.is_admin?(console.log("Redirecting admin to admin dashboard"),t.push("/admin")):(console.log("Redirecting user to dashboard"),t.push("/dashboard"))}else i.Am.error(o.message)}catch(e){i.Am.error("An error occurred. Please try again."),console.error(e)}finally{g(!1)}};return(0,r.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Access the online exam system"})]}),(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:p(v),children:[(0,r.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,r.jsx)(c,{label:"Email Address",type:"email",placeholder:"Email address",...m("email",{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),error:null===(e=f.email)||void 0===e?void 0:e.message}),(0,r.jsx)(c,{label:"Password",type:"password",placeholder:"Password",...m("password",{required:"Password is required",minLength:{value:6,message:"Password must be at least 6 characters"}}),error:null===(o=f.password)||void 0===o?void 0:o.message})]}),(0,r.jsx)("div",{children:(0,r.jsx)(d.Z,{type:"submit",variant:"primary",className:"w-full",disabled:u,children:u?"Signing in...":"Sign in"})})]})]})})}}},function(e){e.O(0,[917,330,536,888,774,179],function(){return e(e.s=6429)}),_N_E=e.O()}]);