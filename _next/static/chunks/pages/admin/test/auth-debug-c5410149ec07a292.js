(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{4998:function(e,o,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/test/auth-debug",function(){return n(1041)}])},4401:function(e,o,n){"use strict";n.d(o,{ts:function(){return m},$8:function(){return h},x4:function(){return u},kS:function(){return g},Rp:function(){return p}});var t=n(7066),s=n(1955),r=n(1752),a=n.n(r);let{publicRuntimeConfig:i={}}=a()()||{},l=i.basePath||"",c=t.Z.create({baseURL:"https://arya-new-project.onrender.com/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let o=s.Z.get("token");return console.log("Request interceptor - Token exists:",!!o),o?(e.headers.Authorization="Bearer ".concat(o),console.log("Adding Authorization header to request")):console.warn("No token found in cookies"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{if(e.response){if(401===e.response.status){console.error("API 401 Unauthorized error:",e.response.data);let o=e.config.url.includes("/auth/");if(!e.config.url.includes("/auth/validate-token")&&(console.warn("Unauthorized access (not during validation), clearing token"),s.Z.remove("token"),o)){let e="".concat(window.location.origin).concat(l,"/login");console.log("Redirecting to login page due to auth failure"),window.location.href=e}}}else console.error("API connection error:",e.message);return Promise.reject(e)});let{publicRuntimeConfig:d={}}=a()()||{};d.basePath;let u=async(e,o)=>{var n,t,r;try{console.log("Attempting login with email:",e);let{access_token:t,user:r}=(await c.post("/auth/login",{email:e,password:o})).data;if(console.log("Login successful, token received:",t?"Yes (length: "+t.length+")":"No"),console.log("User data received:",r),console.log("Is admin:",null==r?void 0:r.is_admin),!t)return console.error("No access token received from server"),{success:!1,message:"Authentication failed: No token received"};s.Z.remove("token"),s.Z.set("token",t,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"});let a=s.Z.get("token");if(console.log("Token stored in cookies:",!!a),console.log("Stored token length:",a?a.length:0),!a)return console.error("Failed to store token in cookies"),{success:!1,message:"Authentication failed: Unable to store token"};localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(r)),console.log("User info stored in localStorage:",r),console.log("Admin status stored:",r.is_admin);try{console.log("Validating token after login...");let e=await p();console.log("Token validation result:",e),e.success&&e.valid?(console.log("Token validated. User data from validation:",e.user),console.log("Admin status from validation:",null===(n=e.user)||void 0===n?void 0:n.is_admin),e.user&&(localStorage.setItem("user",JSON.stringify(e.user)),console.log("Updated user info in localStorage with validated data"))):console.warn("Token validation failed, but continuing with login.")}catch(e){console.error("Error validating token:",e)}return{success:!0,user:r}}catch(e){return console.error("Login error:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Login failed"}}},g=()=>(s.Z.remove("token"),localStorage.removeItem("user"),{success:!0}),m=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},h=()=>!!s.Z.get("token"),p=async()=>{let e=2;for(;e>=0;)try{console.log("Validating token...");let e=await c.get("/auth/validate-token");return console.log("Token validation response:",e.status),console.log("Token validation data:",e.data),e.data.valid&&e.data.user&&(localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Updated user data in localStorage from token validation"),console.log("Admin status from validation:",e.data.user.is_admin)),{success:!0,valid:e.data.valid,user:e.data.user}}catch(a){var o,n,t,s,r;if(!a.response&&e>0){console.warn("Network error during token validation, retrying... (".concat(e," attempts left)")),e--,await new Promise(e=>setTimeout(e,1e3));continue}return console.error("Token validation error:",a.message),console.error("Error response:",null===(o=a.response)||void 0===o?void 0:o.data),(null===(n=a.response)||void 0===n?void 0:n.status)===401&&console.warn("Token is invalid or expired"),{success:!1,valid:!1,status:null===(t=a.response)||void 0===t?void 0:t.status,message:(null===(r=a.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.error)||"Token validation failed"}}}},9029:function(e,o,n){"use strict";n.d(o,{Z:function(){return P}});var t=n(5893),s=n(7294),r=n(9729),a=n(1485),i=n(5071),l=n(7407),c=n(5770),d=n(2248),u=n(7876),g=n(6795),m=n(8539),h=n(2857),p=n(7958),x=n(18),f=n(6459),v=n(3246),k=n(9141),Z=n(5854),j=n(1897),w=n(899),y=n(1664),b=n.n(y),S=n(1163),T=n(9069);function P(e){let{children:o}=e,[n,y]=(0,s.useState)(!1),P=(0,S.useRouter)(),C=()=>{y(!n)},N=[{text:"Dashboard",icon:(0,t.jsx)(x.Z,{}),path:"/admin/dashboard"},{text:"Exams",icon:(0,t.jsx)(f.Z,{}),path:"/admin/exams"},{text:"Candidates",icon:(0,t.jsx)(v.Z,{}),path:"/admin/candidates"},{text:"Results",icon:(0,t.jsx)(k.Z,{}),path:"/admin/results"},{text:"Settings",icon:(0,t.jsx)(Z.Z,{}),path:"/admin/settings"}],A=(0,t.jsxs)(r.Z,{children:[(0,t.jsx)(r.Z,{sx:{p:2},children:(0,t.jsx)(a.Z,{variant:"h6",noWrap:!0,component:"div",children:"Admin Panel"})}),(0,t.jsx)(i.Z,{}),(0,t.jsx)(l.Z,{children:N.map((e,o)=>(0,t.jsx)(b(),{href:e.path,passHref:!0,children:(0,t.jsxs)(c.ZP,{button:!0,component:"a",selected:P.pathname===e.path,children:[(0,t.jsx)(d.Z,{children:e.icon}),(0,t.jsx)(u.Z,{primary:e.text})]})},o))}),(0,t.jsx)(i.Z,{}),(0,t.jsx)(l.Z,{children:(0,t.jsxs)(c.ZP,{button:!0,onClick:()=>{(0,T.kS)(),P.push("/login")},children:[(0,t.jsx)(d.Z,{children:(0,t.jsx)(j.Z,{})}),(0,t.jsx)(u.Z,{primary:"Logout"})]})})]});return(0,t.jsxs)(r.Z,{sx:{display:"flex"},children:[(0,t.jsx)(g.Z,{position:"fixed",sx:{width:{sm:"calc(100% - ".concat(240,"px)")},ml:{sm:"".concat(240,"px")}},children:(0,t.jsxs)(m.Z,{children:[(0,t.jsx)(h.Z,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:C,sx:{mr:2,display:{sm:"none"}},children:(0,t.jsx)(w.Z,{})}),(0,t.jsx)(a.Z,{variant:"h6",noWrap:!0,component:"div",children:"Online Exam Administration"})]})}),(0,t.jsxs)(r.Z,{component:"nav",sx:{width:{sm:240},flexShrink:{sm:0}},children:[(0,t.jsx)(p.ZP,{variant:"temporary",open:n,onClose:C,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},children:A}),(0,t.jsx)(p.ZP,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},open:!0,children:A})]}),(0,t.jsxs)(r.Z,{component:"main",sx:{flexGrow:1,p:3,width:{sm:"calc(100% - ".concat(240,"px)")}},children:[(0,t.jsx)(m.Z,{}),o]})]})}},1041:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return f}});var t=n(5893),s=n(7294),r=n(802),a=n(1754),i=n(1485),l=n(9729),c=n(8947),d=n(4677),u=n(5071),g=n(7182),m=n(7788),h=n(9029),p=n(4401),x=n(9069);function f(){let[e,o]=(0,s.useState)({email:"admin@example.com",password:"adminpassword"}),[n,f]=(0,s.useState)(!1),[v,k]=(0,s.useState)(null),[Z,j]=(0,s.useState)(null),[w,y]=(0,s.useState)(""),b=n=>{let{name:t,value:s}=n.target;o({...e,[t]:s})},S=async()=>{f(!0),k(null),j(null);try{console.log("Attempting login with:",e);let o=await (0,p.x4)(e.email,e.password);if(console.log("Login response:",o),o.success)k({success:!0,message:"Login successful",data:o}),y((0,x.LP)());else throw Error(o.message||"Login failed")}catch(e){console.error("Login error:",e),j(e.message||"Unknown error occurred")}finally{f(!1)}},T=async()=>{f(!0),k(null),j(null);try{console.log("Attempting direct API login with:",e);let o=await fetch("http://localhost:5000/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})}),n=await o.json();if(console.log("Direct login response:",o.status,n),o.ok&&n.token)(0,x.o4)(n.token),y(n.token),k({success:!0,message:"Direct login successful",data:n});else throw Error("Login failed: ".concat(n.message||"Unknown error"))}catch(e){console.error("Direct login error:",e),j(e.message||"Unknown error occurred")}finally{f(!1)}};return(0,t.jsx)(h.Z,{children:(0,t.jsx)(r.Z,{maxWidth:"md",sx:{mt:4,mb:4},children:(0,t.jsxs)(a.Z,{sx:{p:3},children:[(0,t.jsx)(i.Z,{variant:"h4",gutterBottom:!0,children:"Authentication Debugging"}),(0,t.jsxs)(l.Z,{sx:{mb:4},children:[(0,t.jsx)(i.Z,{variant:"h6",gutterBottom:!0,children:"Login Credentials"}),(0,t.jsx)(c.Z,{fullWidth:!0,label:"Email",name:"email",value:e.email,onChange:b,margin:"normal"}),(0,t.jsx)(c.Z,{fullWidth:!0,label:"Password",name:"password",type:"password",value:e.password,onChange:b,margin:"normal"}),(0,t.jsxs)(l.Z,{sx:{mt:2,display:"flex",gap:2},children:[(0,t.jsx)(d.Z,{variant:"contained",onClick:S,disabled:n,children:"Test Normal Login"}),(0,t.jsx)(d.Z,{variant:"outlined",onClick:T,disabled:n,children:"Test Direct API Login"})]})]}),(0,t.jsx)(u.Z,{sx:{my:3}}),(0,t.jsxs)(l.Z,{sx:{mb:4},children:[(0,t.jsx)(i.Z,{variant:"h6",gutterBottom:!0,children:"Token Management"}),(0,t.jsxs)(l.Z,{sx:{display:"flex",gap:2,mb:2},children:[(0,t.jsx)(d.Z,{variant:"outlined",onClick:()=>{let e=(0,x.LP)();y(e||""),k({success:!!e,message:e?"Token retrieved":"No token found"})},color:"primary",children:"Get Current Token"}),(0,t.jsx)(d.Z,{variant:"outlined",onClick:()=>{(0,x.gy)(),y(""),k({success:!0,message:"Token cleared successfully"})},color:"secondary",children:"Clear Token"}),(0,t.jsx)(d.Z,{variant:"outlined",onClick:()=>{try{let e=w||(0,x.LP)();if(!e)throw Error("No token available to decode");let o=e.split(".");if(3!==o.length)throw Error("Invalid JWT token format");let n=JSON.parse(atob(o[1]));console.log("Decoded token payload:",n),k({success:!0,message:"Token decoded successfully",data:{payload:n}})}catch(e){console.error("Token decode error:",e),j(e.message||"Failed to decode token")}},disabled:!w,children:"Decode Token"})]}),(0,t.jsx)(c.Z,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:w,onChange:e=>y(e.target.value),placeholder:"JWT Token",margin:"normal"})]}),n&&(0,t.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,t.jsx)(g.Z,{})}),Z&&(0,t.jsx)(m.Z,{severity:"error",sx:{mt:3},children:Z}),v&&(0,t.jsxs)(l.Z,{sx:{mt:3},children:[(0,t.jsx)(m.Z,{severity:v.success?"success":"warning",children:v.message}),v.data&&(0,t.jsx)(a.Z,{sx:{p:2,bgcolor:"#f5f5f5",mt:2},children:(0,t.jsx)("pre",{children:JSON.stringify(v.data,null,2)})})]})]})})})}},9069:function(e,o,n){"use strict";n.d(o,{LP:function(){return s},gy:function(){return a},kS:function(){return l},o4:function(){return r}});var t=n(1955);let s=()=>t.Z.get("token"),r=e=>{t.Z.set("token",e,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"})},a=()=>{t.Z.remove("token")},i=()=>{localStorage.removeItem("user")},l=()=>{a(),i()}}},function(e){e.O(0,[917,330,475,834,888,774,179],function(){return e(e.s=4998)}),_N_E=e.O()}]);