(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[373],{2219:function(e,o,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/test/token",function(){return n(2129)}])},4401:function(e,o,n){"use strict";n.d(o,{ts:function(){return h},$8:function(){return m},x4:function(){return u},kS:function(){return g},Rp:function(){return x}});var t=n(7066),r=n(1955),s=n(1752),a=n.n(s);let{publicRuntimeConfig:i={}}=a()()||{},l=i.basePath||"",c=t.Z.create({baseURL:"https://arya-new-project.onrender.com/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let o=r.Z.get("token");return console.log("Request interceptor - Token exists:",!!o),o?(e.headers.Authorization="Bearer ".concat(o),console.log("Adding Authorization header to request")):console.warn("No token found in cookies"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{if(e.response){if(401===e.response.status){console.error("API 401 Unauthorized error:",e.response.data);let o=e.config.url.includes("/auth/");if(!e.config.url.includes("/auth/validate-token")&&(console.warn("Unauthorized access (not during validation), clearing token"),r.Z.remove("token"),o)){let e="".concat(window.location.origin).concat(l,"/login");console.log("Redirecting to login page due to auth failure"),window.location.href=e}}}else console.error("API connection error:",e.message);return Promise.reject(e)});let{publicRuntimeConfig:d={}}=a()()||{};d.basePath;let u=async(e,o)=>{var n,t,s;try{console.log("Attempting login with email:",e);let{access_token:t,user:s}=(await c.post("/auth/login",{email:e,password:o})).data;if(console.log("Login successful, token received:",t?"Yes (length: "+t.length+")":"No"),console.log("User data received:",s),console.log("Is admin:",null==s?void 0:s.is_admin),!t)return console.error("No access token received from server"),{success:!1,message:"Authentication failed: No token received"};r.Z.remove("token"),r.Z.set("token",t,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"});let a=r.Z.get("token");if(console.log("Token stored in cookies:",!!a),console.log("Stored token length:",a?a.length:0),!a)return console.error("Failed to store token in cookies"),{success:!1,message:"Authentication failed: Unable to store token"};localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(s)),console.log("User info stored in localStorage:",s),console.log("Admin status stored:",s.is_admin);try{console.log("Validating token after login...");let e=await x();console.log("Token validation result:",e),e.success&&e.valid?(console.log("Token validated. User data from validation:",e.user),console.log("Admin status from validation:",null===(n=e.user)||void 0===n?void 0:n.is_admin),e.user&&(localStorage.setItem("user",JSON.stringify(e.user)),console.log("Updated user info in localStorage with validated data"))):console.warn("Token validation failed, but continuing with login.")}catch(e){console.error("Error validating token:",e)}return{success:!0,user:s}}catch(e){return console.error("Login error:",e),{success:!1,message:(null===(s=e.response)||void 0===s?void 0:null===(t=s.data)||void 0===t?void 0:t.error)||"Login failed"}}},g=()=>(r.Z.remove("token"),localStorage.removeItem("user"),{success:!0}),h=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},m=()=>!!r.Z.get("token"),x=async()=>{let e=2;for(;e>=0;)try{console.log("Validating token...");let e=await c.get("/auth/validate-token");return console.log("Token validation response:",e.status),console.log("Token validation data:",e.data),e.data.valid&&e.data.user&&(localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Updated user data in localStorage from token validation"),console.log("Admin status from validation:",e.data.user.is_admin)),{success:!0,valid:e.data.valid,user:e.data.user}}catch(a){var o,n,t,r,s;if(!a.response&&e>0){console.warn("Network error during token validation, retrying... (".concat(e," attempts left)")),e--,await new Promise(e=>setTimeout(e,1e3));continue}return console.error("Token validation error:",a.message),console.error("Error response:",null===(o=a.response)||void 0===o?void 0:o.data),(null===(n=a.response)||void 0===n?void 0:n.status)===401&&console.warn("Token is invalid or expired"),{success:!1,valid:!1,status:null===(t=a.response)||void 0===t?void 0:t.status,message:(null===(s=a.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.error)||"Token validation failed"}}}},9029:function(e,o,n){"use strict";n.d(o,{Z:function(){return P}});var t=n(5893),r=n(7294),s=n(9729),a=n(1485),i=n(5071),l=n(7407),c=n(5770),d=n(2248),u=n(7876),g=n(6795),h=n(8539),m=n(2857),x=n(7958),p=n(18),v=n(6459),f=n(3246),k=n(9141),Z=n(5854),j=n(1897),w=n(899),S=n(1664),y=n.n(S),b=n(1163),T=n(9069);function P(e){let{children:o}=e,[n,S]=(0,r.useState)(!1),P=(0,b.useRouter)(),_=()=>{S(!n)},N=[{text:"Dashboard",icon:(0,t.jsx)(p.Z,{}),path:"/admin/dashboard"},{text:"Exams",icon:(0,t.jsx)(v.Z,{}),path:"/admin/exams"},{text:"Candidates",icon:(0,t.jsx)(f.Z,{}),path:"/admin/candidates"},{text:"Results",icon:(0,t.jsx)(k.Z,{}),path:"/admin/results"},{text:"Settings",icon:(0,t.jsx)(Z.Z,{}),path:"/admin/settings"}],A=(0,t.jsxs)(s.Z,{children:[(0,t.jsx)(s.Z,{sx:{p:2},children:(0,t.jsx)(a.Z,{variant:"h6",noWrap:!0,component:"div",children:"Admin Panel"})}),(0,t.jsx)(i.Z,{}),(0,t.jsx)(l.Z,{children:N.map((e,o)=>(0,t.jsx)(y(),{href:e.path,passHref:!0,children:(0,t.jsxs)(c.ZP,{button:!0,component:"a",selected:P.pathname===e.path,children:[(0,t.jsx)(d.Z,{children:e.icon}),(0,t.jsx)(u.Z,{primary:e.text})]})},o))}),(0,t.jsx)(i.Z,{}),(0,t.jsx)(l.Z,{children:(0,t.jsxs)(c.ZP,{button:!0,onClick:()=>{(0,T.kS)(),P.push("/login")},children:[(0,t.jsx)(d.Z,{children:(0,t.jsx)(j.Z,{})}),(0,t.jsx)(u.Z,{primary:"Logout"})]})})]});return(0,t.jsxs)(s.Z,{sx:{display:"flex"},children:[(0,t.jsx)(g.Z,{position:"fixed",sx:{width:{sm:"calc(100% - ".concat(240,"px)")},ml:{sm:"".concat(240,"px")}},children:(0,t.jsxs)(h.Z,{children:[(0,t.jsx)(m.Z,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:_,sx:{mr:2,display:{sm:"none"}},children:(0,t.jsx)(w.Z,{})}),(0,t.jsx)(a.Z,{variant:"h6",noWrap:!0,component:"div",children:"Online Exam Administration"})]})}),(0,t.jsxs)(s.Z,{component:"nav",sx:{width:{sm:240},flexShrink:{sm:0}},children:[(0,t.jsx)(x.ZP,{variant:"temporary",open:n,onClose:_,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},children:A}),(0,t.jsx)(x.ZP,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:240}},open:!0,children:A})]}),(0,t.jsxs)(s.Z,{component:"main",sx:{flexGrow:1,p:3,width:{sm:"calc(100% - ".concat(240,"px)")}},children:[(0,t.jsx)(h.Z,{}),o]})]})}},2129:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return x}});var t=n(5893),r=n(7294),s=n(4401),a=n(9069),i=n(802),l=n(1754),c=n(1485),d=n(9729),u=n(8947),g=n(4677),h=n(7788),m=n(9029);function x(){let[e,o]=(0,r.useState)(""),[n,x]=(0,r.useState)(null),[p,v]=(0,r.useState)(!1),[f,k]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=(0,a.LP)();e&&o(e)},[]);let Z=async()=>{v(!0);try{let o=await (0,s.Rp)(e);console.log("Token validation result:",o),x(o)}catch(e){console.error("Error validating token:",e),x({valid:!1,error:e.message||"Unknown error occurred"})}finally{v(!1)}},j=async()=>{v(!0);try{let e=await (0,s.Rp)(f);console.log("Manual token validation result:",e),x(e)}catch(e){console.error("Error validating manual token:",e),x({valid:!1,error:e.message||"Unknown error occurred"})}finally{v(!1)}};return(0,t.jsx)(m.Z,{children:(0,t.jsx)(i.Z,{maxWidth:"md",sx:{mt:4,mb:4},children:(0,t.jsxs)(l.Z,{sx:{p:3},children:[(0,t.jsx)(c.Z,{variant:"h4",gutterBottom:!0,children:"JWT Token Debugging"}),(0,t.jsxs)(d.Z,{sx:{mb:4},children:[(0,t.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"Stored Token"}),(0,t.jsx)(u.Z,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:e,onChange:e=>o(e.target.value),margin:"normal"}),(0,t.jsx)(g.Z,{variant:"contained",onClick:Z,disabled:p||!e,sx:{mt:2},children:"Validate Stored Token"})]}),(0,t.jsxs)(d.Z,{sx:{mb:4},children:[(0,t.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"Manual Token Input"}),(0,t.jsx)(u.Z,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",value:f,onChange:e=>k(e.target.value),placeholder:"Paste a JWT token here to validate",margin:"normal"}),(0,t.jsx)(g.Z,{variant:"contained",onClick:j,disabled:p||!f,sx:{mt:2},children:"Validate Manual Token"})]}),n&&(0,t.jsxs)(d.Z,{sx:{mt:4},children:[(0,t.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"Validation Result"}),(0,t.jsx)(h.Z,{severity:n.valid?"success":"error",children:n.valid?"Token is valid!":"Token validation failed: ".concat(n.error)}),n.payload&&(0,t.jsxs)(d.Z,{sx:{mt:2},children:[(0,t.jsx)(c.Z,{variant:"subtitle1",children:"Token Payload:"}),(0,t.jsx)(l.Z,{sx:{p:2,bgcolor:"#f5f5f5"},children:(0,t.jsx)("pre",{children:JSON.stringify(n.payload,null,2)})})]})]})]})})})}},9069:function(e,o,n){"use strict";n.d(o,{LP:function(){return r},gy:function(){return a},kS:function(){return l},o4:function(){return s}});var t=n(1955);let r=()=>t.Z.get("token"),s=e=>{t.Z.set("token",e,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"})},a=()=>{t.Z.remove("token")},i=()=>{localStorage.removeItem("user")},l=()=>{a(),i()}}},function(e){e.O(0,[917,330,475,834,888,774,179],function(){return e(e.s=2219)}),_N_E=e.O()}]);