(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(9828)}])},4401:function(e,o,t){"use strict";t.d(o,{ts:function(){return f},$8:function(){return p},x4:function(){return d},kS:function(){return g},Rp:function(){return v}});var n=t(7066),r=t(1955),i=t(1752),s=t.n(i);let{publicRuntimeConfig:a={}}=s()()||{},l=a.basePath||"",c=n.Z.create({baseURL:"https://arya-new-project.onrender.com/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let o=r.Z.get("token");return console.log("Request interceptor - Token exists:",!!o),o?(e.headers.Authorization="Bearer ".concat(o),console.log("Adding Authorization header to request")):console.warn("No token found in cookies"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{if(e.response){if(401===e.response.status){console.error("API 401 Unauthorized error:",e.response.data);let o=e.config.url.includes("/auth/");if(!e.config.url.includes("/auth/validate-token")&&(console.warn("Unauthorized access (not during validation), clearing token"),r.Z.remove("token"),o)){let e="".concat(window.location.origin).concat(l,"/login");console.log("Redirecting to login page due to auth failure"),window.location.href=e}}}else console.error("API connection error:",e.message);return Promise.reject(e)});let{publicRuntimeConfig:u={}}=s()()||{};u.basePath;let d=async(e,o)=>{var t,n,i;try{console.log("Attempting login with email:",e);let{access_token:n,user:i}=(await c.post("/auth/login",{email:e,password:o})).data;if(console.log("Login successful, token received:",n?"Yes (length: "+n.length+")":"No"),console.log("User data received:",i),console.log("Is admin:",null==i?void 0:i.is_admin),!n)return console.error("No access token received from server"),{success:!1,message:"Authentication failed: No token received"};r.Z.remove("token"),r.Z.set("token",n,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"});let s=r.Z.get("token");if(console.log("Token stored in cookies:",!!s),console.log("Stored token length:",s?s.length:0),!s)return console.error("Failed to store token in cookies"),{success:!1,message:"Authentication failed: Unable to store token"};localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(i)),console.log("User info stored in localStorage:",i),console.log("Admin status stored:",i.is_admin);try{console.log("Validating token after login...");let e=await v();console.log("Token validation result:",e),e.success&&e.valid?(console.log("Token validated. User data from validation:",e.user),console.log("Admin status from validation:",null===(t=e.user)||void 0===t?void 0:t.is_admin),e.user&&(localStorage.setItem("user",JSON.stringify(e.user)),console.log("Updated user info in localStorage with validated data"))):console.warn("Token validation failed, but continuing with login.")}catch(e){console.error("Error validating token:",e)}return{success:!0,user:i}}catch(e){return console.error("Login error:",e),{success:!1,message:(null===(i=e.response)||void 0===i?void 0:null===(n=i.data)||void 0===n?void 0:n.error)||"Login failed"}}},g=()=>(r.Z.remove("token"),localStorage.removeItem("user"),{success:!0}),f=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},p=()=>!!r.Z.get("token"),v=async()=>{let e=2;for(;e>=0;)try{console.log("Validating token...");let e=await c.get("/auth/validate-token");return console.log("Token validation response:",e.status),console.log("Token validation data:",e.data),e.data.valid&&e.data.user&&(localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Updated user data in localStorage from token validation"),console.log("Admin status from validation:",e.data.user.is_admin)),{success:!0,valid:e.data.valid,user:e.data.user}}catch(s){var o,t,n,r,i;if(!s.response&&e>0){console.warn("Network error during token validation, retrying... (".concat(e," attempts left)")),e--,await new Promise(e=>setTimeout(e,1e3));continue}return console.error("Token validation error:",s.message),console.error("Error response:",null===(o=s.response)||void 0===o?void 0:o.data),(null===(t=s.response)||void 0===t?void 0:t.status)===401&&console.warn("Token is invalid or expired"),{success:!1,valid:!1,status:null===(n=s.response)||void 0===n?void 0:n.status,message:(null===(i=s.response)||void 0===i?void 0:null===(r=i.data)||void 0===r?void 0:r.error)||"Token validation failed"}}}},9828:function(e,o,t){"use strict";t.r(o);var n=t(5893),r=t(7294),i=t(1163),s=t(4401);o.default=()=>{let e=(0,i.useRouter)();return(0,r.useEffect)(()=>{if((0,s.$8)()){let o=(0,s.ts)();console.log("Home page: Authenticated user:",o),o&&o.is_admin?(console.log("Home page: Redirecting admin to admin dashboard"),e.push("/admin")):(console.log("Home page: Redirecting user to user dashboard"),e.push("/dashboard"))}else console.log("Home page: No authentication, redirecting to login"),e.push("/login")},[e]),(0,n.jsx)("div",{className:"min-h-full flex items-center justify-center",children:(0,n.jsx)("p",{children:"Redirecting..."})})}},1163:function(e,o,t){e.exports=t(3079)},1955:function(e,o,t){"use strict";function n(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var n in t)e[n]=t[n]}return e}t.d(o,{Z:function(){return r}});var r=function e(o,t){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=n({},t,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a].split(";")[0]));return document.cookie=e+"="+o.write(r,e)+s}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},r=0;r<t.length;r++){var i=t[r].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(n[a]=o.read(s,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(e,o){r(e,"",n({},o,{expires:-1}))},withAttributes:function(o){return e(this.converter,n({},this.attributes,o))},withConverter:function(o){return e(n({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(o)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}},function(e){e.O(0,[330,888,774,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);