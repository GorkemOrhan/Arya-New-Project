"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[930],{4401:function(e,t,r){r.d(t,{ts:function(){return m},$8:function(){return g},x4:function(){return u},kS:function(){return h},Rp:function(){return x}});var o=r(7066),a=r(1955),n=r(1752),s=r.n(n);let{publicRuntimeConfig:i={}}=s()()||{},l=i.basePath||"",c=o.Z.create({baseURL:"https://arya-new-project.onrender.com/api",headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{let t=a.Z.get("token");return console.log("Request interceptor - Token exists:",!!t),t?(e.headers.Authorization="Bearer ".concat(t),console.log("Adding Authorization header to request")):console.warn("No token found in cookies"),e},e=>Promise.reject(e)),c.interceptors.response.use(e=>e,e=>{if(e.response){if(401===e.response.status){console.error("API 401 Unauthorized error:",e.response.data);let t=e.config.url.includes("/auth/");if(!e.config.url.includes("/auth/validate-token")&&(console.warn("Unauthorized access (not during validation), clearing token"),a.Z.remove("token"),t)){let e="".concat(window.location.origin).concat(l,"/login");console.log("Redirecting to login page due to auth failure"),window.location.href=e}}}else console.error("API connection error:",e.message);return Promise.reject(e)});let{publicRuntimeConfig:d={}}=s()()||{};d.basePath;let u=async(e,t)=>{var r,o,n;try{console.log("Attempting login with email:",e);let{access_token:o,user:n}=(await c.post("/auth/login",{email:e,password:t})).data;if(console.log("Login successful, token received:",o?"Yes (length: "+o.length+")":"No"),console.log("User data received:",n),console.log("Is admin:",null==n?void 0:n.is_admin),!o)return console.error("No access token received from server"),{success:!1,message:"Authentication failed: No token received"};a.Z.remove("token"),a.Z.set("token",o,{expires:1,secure:"https:"===window.location.protocol,sameSite:"lax"});let s=a.Z.get("token");if(console.log("Token stored in cookies:",!!s),console.log("Stored token length:",s?s.length:0),!s)return console.error("Failed to store token in cookies"),{success:!1,message:"Authentication failed: Unable to store token"};localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(n)),console.log("User info stored in localStorage:",n),console.log("Admin status stored:",n.is_admin);try{console.log("Validating token after login...");let e=await x();console.log("Token validation result:",e),e.success&&e.valid?(console.log("Token validated. User data from validation:",e.user),console.log("Admin status from validation:",null===(r=e.user)||void 0===r?void 0:r.is_admin),e.user&&(localStorage.setItem("user",JSON.stringify(e.user)),console.log("Updated user info in localStorage with validated data"))):console.warn("Token validation failed, but continuing with login.")}catch(e){console.error("Error validating token:",e)}return{success:!0,user:n}}catch(e){return console.error("Login error:",e),{success:!1,message:(null===(n=e.response)||void 0===n?void 0:null===(o=n.data)||void 0===o?void 0:o.error)||"Login failed"}}},h=()=>(a.Z.remove("token"),localStorage.removeItem("user"),{success:!0}),m=()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},g=()=>!!a.Z.get("token"),x=async()=>{let e=2;for(;e>=0;)try{console.log("Validating token...");let e=await c.get("/auth/validate-token");return console.log("Token validation response:",e.status),console.log("Token validation data:",e.data),e.data.valid&&e.data.user&&(localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Updated user data in localStorage from token validation"),console.log("Admin status from validation:",e.data.user.is_admin)),{success:!0,valid:e.data.valid,user:e.data.user}}catch(s){var t,r,o,a,n;if(!s.response&&e>0){console.warn("Network error during token validation, retrying... (".concat(e," attempts left)")),e--,await new Promise(e=>setTimeout(e,1e3));continue}return console.error("Token validation error:",s.message),console.error("Error response:",null===(t=s.response)||void 0===t?void 0:t.data),(null===(r=s.response)||void 0===r?void 0:r.status)===401&&console.warn("Token is invalid or expired"),{success:!1,valid:!1,status:null===(o=s.response)||void 0===o?void 0:o.status,message:(null===(n=s.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.error)||"Token validation failed"}}}},1908:function(e,t,r){var o=r(5893),a=r(7294),n=r(1163),s=r(1664),i=r.n(s),l=r(4052),c=r(4401),d=r(1955);t.Z=e=>{let{children:t}=e,r=(0,n.useRouter)(),[s,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!0,t=!1;return(async()=>{try{let o=(0,c.$8)();if(console.log("LocalLayout: Token exists in cookies:",o),!o){console.log("MainLayout: No token found, redirecting to login"),e&&!t&&(t=!0,r.push("/login"));return}let a=(0,c.ts)();console.log("MainLayout: Current user from localStorage:",a?a.username:"none"),a&&m(a);try{let e=await fetch("http://localhost:5000/api/auth/validate-token",{method:"GET",headers:{Authorization:"Bearer ".concat(d.Z.get("token")),"Content-Type":"application/json"}});e.ok?console.log("MainLayout: Token validated successfully with backend"):console.warn("MainLayout: Token validation failed, status:",e.status)}catch(e){console.error("MainLayout: Error validating token with backend:",e)}}catch(e){console.error("MainLayout: Error in authentication check:",e)}})(),()=>{e=!1}},[r]);let g=()=>{(0,c.kS)(),r.push("/login")},x=()=>{u(!s)},f=[{name:"User Dashboard",href:"/dashboard",icon:l.m6D},{name:"Admin Dashboard",href:"/admin",icon:l.nbt}];return(0,o.jsxs)("div",{className:"min-h-full",children:[(0,o.jsx)("div",{className:"lg:hidden",children:(0,o.jsxs)("div",{className:"fixed inset-0 flex z-40",children:[(0,o.jsxs)("button",{type:"button",className:"fixed top-4 right-4 p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:x,children:[(0,o.jsx)("span",{className:"sr-only",children:"Open main menu"}),s?(0,o.jsx)(l.q5L,{className:"block h-6 w-6","aria-hidden":"true"}):(0,o.jsx)(l.cur,{className:"block h-6 w-6","aria-hidden":"true"})]}),s&&(0,o.jsxs)("div",{className:"fixed inset-0 z-40 flex",children:[(0,o.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:x}),(0,o.jsxs)("div",{className:"relative flex-1 flex flex-col max-w-xs w-full bg-white",children:[(0,o.jsxs)("div",{className:"flex-1 h-0 pt-5 pb-4 overflow-y-auto",children:[(0,o.jsx)("div",{className:"flex-shrink-0 flex items-center px-4",children:(0,o.jsx)(i(),{href:"/dashboard",className:"text-xl font-bold text-primary-600 hover:text-primary-700",children:"App Boilerplate"})}),(0,o.jsx)("nav",{className:"mt-5 px-2 space-y-1",children:f.map(e=>(0,o.jsxs)(i(),{href:e.href,className:"group flex items-center px-2 py-2 text-base font-medium rounded-md ".concat("/dashboard"===e.href||"/admin"===e.href?r.pathname===e.href?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900":r.pathname.startsWith(e.href)?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,o.jsx)(e.icon,{className:"mr-4 flex-shrink-0 h-6 w-6 ".concat("/dashboard"===e.href||"/admin"===e.href?r.pathname===e.href?"text-primary-500":"text-gray-400 group-hover:text-gray-500":r.pathname.startsWith(e.href)?"text-primary-500":"text-gray-400 group-hover:text-gray-500"),"aria-hidden":"true"}),e.name]},e.name))})]}),(0,o.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,o.jsxs)("button",{onClick:g,className:"flex items-center text-base font-medium text-gray-600 hover:text-gray-900",children:[(0,o.jsx)(l.xqh,{className:"mr-4 flex-shrink-0 h-6 w-6 text-gray-400"}),"Logout"]})})]})]})]})}),(0,o.jsx)("div",{className:"hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0",children:(0,o.jsxs)("div",{className:"flex-1 flex flex-col min-h-0 border-r border-gray-200 bg-white",children:[(0,o.jsxs)("div",{className:"flex-1 flex flex-col pt-5 pb-4 overflow-y-auto",children:[(0,o.jsx)("div",{className:"flex items-center flex-shrink-0 px-4",children:(0,o.jsx)(i(),{href:"/dashboard",className:"text-xl font-bold text-primary-600 hover:text-primary-700",children:"App Boilerplate"})}),(0,o.jsx)("nav",{className:"mt-5 flex-1 px-2 bg-white space-y-1",children:f.map(e=>(0,o.jsxs)(i(),{href:e.href,className:"group flex items-center px-2 py-2 text-sm font-medium rounded-md ".concat("/dashboard"===e.href||"/admin"===e.href?r.pathname===e.href?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900":r.pathname.startsWith(e.href)?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,o.jsx)(e.icon,{className:"mr-3 flex-shrink-0 h-6 w-6 ".concat("/dashboard"===e.href||"/admin"===e.href?r.pathname===e.href?"text-primary-500":"text-gray-400 group-hover:text-gray-500":r.pathname.startsWith(e.href)?"text-primary-500":"text-gray-400 group-hover:text-gray-500"),"aria-hidden":"true"}),e.name]},e.name))})]}),(0,o.jsx)("div",{className:"flex-shrink-0 flex border-t border-gray-200 p-4",children:(0,o.jsxs)("button",{onClick:g,className:"group flex items-center px-2 py-2 text-sm font-medium w-full text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md",children:[(0,o.jsx)(l.xqh,{className:"mr-3 flex-shrink-0 h-6 w-6 text-gray-400 group-hover:text-gray-500","aria-hidden":"true"}),"Logout"]})})]})}),(0,o.jsx)("div",{className:"lg:pl-64 flex flex-col flex-1",children:(0,o.jsx)("main",{className:"flex-1 pb-10",children:(0,o.jsx)("div",{className:"py-6",children:(0,o.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:t})})})})]})}},6676:function(e,t,r){var o=r(5893);r(7294),t.Z=e=>{let{children:t,title:r,subtitle:a,footer:n,className:s="",...i}=e;return(0,o.jsxs)("div",{className:"card ".concat(s),...i,children:[(r||a)&&(0,o.jsxs)("div",{className:"mb-4",children:[r&&(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:r}),a&&(0,o.jsx)("p",{className:"text-sm text-gray-500",children:a})]}),(0,o.jsx)("div",{children:t}),n&&(0,o.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:n})]})}},6771:function(e,t,r){r.d(t,{w_:function(){return l}});var o=r(7294),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},n=o.createContext&&o.createContext(a),s=function(){return(s=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},i=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&0>t.indexOf(o)&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,o=Object.getOwnPropertySymbols(e);a<o.length;a++)0>t.indexOf(o[a])&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(r[o[a]]=e[o[a]]);return r};function l(e){return function(t){return o.createElement(c,s({attr:s({},e.attr)},t),function e(t){return t&&t.map(function(t,r){return o.createElement(t.tag,s({key:r},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var r,a=e.attr,n=e.size,l=e.title,c=i(e,["attr","size","title"]),d=n||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),o.createElement("svg",s({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,c,{className:r,style:s(s({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),l&&o.createElement("title",null,l),e.children)};return void 0!==n?o.createElement(n.Consumer,null,function(e){return t(e)}):t(a)}}}]);